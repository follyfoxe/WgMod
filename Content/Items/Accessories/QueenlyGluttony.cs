using System.Configuration;
using System.Drawing;
using Microsoft.Xna.Framework;
using Mono.CompilerServices.SymbolWriter;
using Terraria;
using Terraria.ID;
using Terraria.ModLoader;
using WgMod.Common.Players;

namespace WgMod.Content.Items.Accessories;

[Credit(ProjectRole.Programmer, Contributor.maimaichubs)]
[Credit(ProjectRole.Artist, Contributor.trilophyte)]
public class QueenlyGluttony : ModItem
{
    float _damage;
    float _attackSpeed;
    int _critChance;
    int _armorPenetration;

    public override void SetDefaults()
    {
        Item.width = 28;
        Item.height = 30;

        Item.accessory = true;
        Item.rare = ItemRarityID.Pink;
        Item.value = Item.buyPrice(gold: 4);
    }

    public override void UpdateAccessory(Player player, bool hideVisual)
    {
        if (!player.TryGetModPlayer(out WgPlayer wg))
            return;
        if (!player.TryGetModPlayer(out QueenlyGluttonyPlayer qg))
            return;

        float immobility = wg.Weight.ClampedImmobility;
        _damage = float.Lerp(0.05f, 0.2f, immobility);
        _attackSpeed = float.Lerp(0.96f, 0.85f, immobility);
        _critChance = (int)float.Lerp(5f, 10f, immobility);
        _armorPenetration = (int)float.Lerp(2f, 6f, immobility);

        player.GetDamage(DamageClass.Melee) += _damage;
        player.GetAttackSpeed(DamageClass.Melee) *= _attackSpeed;
        player.GetCritChance(DamageClass.Melee) += _critChance;
        player.GetArmorPenetration(DamageClass.Melee) += _armorPenetration;

        qg._active = true;
    }
}

public class QueenlyGluttonyPlayer : ModPlayer
{
    internal bool _active;

    public override void ResetEffects()
    {
        _active = false;
    }

    public override void OnHitNPC(NPC target, NPC.HitInfo hit, int damageDone)
    {
        if (
            _active
            && (hit.DamageType == DamageClass.Melee || hit.DamageType == DamageClass.MeleeNoSpeed)
        )
        {
            if (Main.rand.NextBool(50))
                target.AddBuff(BuffID.Shimmer, 2 * 60);
            else
                target.AddBuff(BuffID.GelBalloonBuff, 2 * 60);
        }
    }

    public override void EmitEnchantmentVisualsAt(Projectile projectile, Vector2 boxPosition, int boxWidth, int boxHeight)
    {
        if (!Player.TryGetModPlayer(out QueenlyGluttonyPlayer qg))
            return;

        if (qg._active && (projectile.DamageType == DamageClass.Melee || projectile.DamageType == DamageClass.MeleeNoSpeed) && Main.rand.Next(3) != 0)
        {
            int index = Dust.NewDust(boxPosition, boxWidth, boxHeight, DustID.PinkSlime, 0f, 0f, 100, default, 1f);
            Main.dust[index].noGravity = true;
        }
    }
}


//                                                                        **********+%
//                                                                       @***###****+*=**
//                                                                       ****-+***###*#*+**
//                                                                      #*#%##******+*##%**+
//                                                                     %*###%%#####******#*#@
//                                                                      @#%*#%%%%%@%%#%##%%#
//                                                                       %#@#%%%@%%%%@%#%%#-%
//                                                       *::.. ...........=###%%@%%%%#%%#*#+
//                                                      *=-::=.-......:=.:*%%++#+-%%%%%%#*++-::
//                                                     *--::::.....==+======#@+@%*+*++#+-@
//                                                   +**-:::-....-.:.==++======*#*%
//                                                  ==***#**:...-.....===*=====*.*   :==....===-+=
//                                                 #:.:***%=+:.........======*==.= :*#=.........#==-
//                                                 =*+:**=====.........:===:.....* *==::::+:.....===-
//                                                 ****#+======-........=:.......+-:+:....:-:========-@
//                                                   **==========..............=+::@+-*-=::=-.==#===*==
//                                                  %==============............*=++#%:::--:::+-:==+.===:
//                                                   ================.........=@===.+:+::%=%+-.:==+:=:==
//                                                   =====+%=+---======....===:==+=:=::::.-++:-*==+:====
//                                                   -===+======----======+==::=%+:::::::::+-:====+:*===
//                                                   ---==--======#---==+==+#=%#-=::**#*=:-+%+#====**:==
//                                                    ---====+--+===%====+#=#+*#-==:::::-::-============
//                                                     ----========##===*=-#*###%===%*%*:.::=#=====#*===
//                                                     %-----==-===+#+==#==******#%###=:::=*+*=*=========
//                                                      %----=--====-%====****##*#####===%##:*#=*+===*=**
//                                                       %-------==*+=**#****+#*%###%%####:#*+=======*#**=
//                                                       +*---*-********#*#++*++=+%#%#++:#++**====*****#**
//                                                      %+*********#%%#%#+++.:::::.:.:+:+++##*+*======+#+
//                                                     *******##*%##*+*++:::::::-++.:.+.::+**#======#===%
//                                                   ****#==+=##=+##+++:::::::::+.*++::::=+*%======+=====
//                                                %=-=+===#*+=*###%%%@%%%+.:::::::+++:::.+%============*=%
//                                         %----===#==#+=*=#####%%%%%@@##%#@+++++::::::++++===========*==-
//                                     %--======+=+#+-*=########@%%@--#+%%.+####%++.:::+++===============+
//                                   -========+++====######%%%%%%+.:.%+::::::::###%::::++#=====**====+@...*
//                                 ==========++===+############+:::*#:::::::::::+%##+::++*=====*====+==....
//                                *=========*%+#************##%:##%+:::::::::::::.@%#++++#%===*=====*==..===
//                               +*=======+-*=**************##-:::::::::::::::::::++%%++###===+=======....=:%
//                              @**======###=#*************##%:::::::::::::::::::::+*######========+==.....#.+
//                              @+=*====+#==***************##+:::::::::::::::::::::#-======#===*===**-.....-*=#%
//                              @+=+**=*+==#***%***********##++::::::::::::::---------==###%=======*%*.......:.##
//                               --==#+===**************#**#=++::::::::==-------##%**+++++++*======*=**+....*...*##
//                                --=*#=*=   +++**%********#+++:::.=======+#%+++**+*+***++++*====*=*=+*+@...........#
//                                 +:***==     +++++*+******++:======+##+*#####%*+++++++++++%%===***=====%............#
//                                  %+*#=*      %+++++*****#=====+#*######*++++++++-::::=++++##===#*=======......=......*
//                                    *%#+        ++++**=====+########+++++++++:::::::::::.+++#+==+*======*.-*...===......*
//                                    ++#+         +++====########+++++++++=:::::::=.:===.:=+++#===+======%===...==.........*
//                                     +*%@       %+===##*####@+++++++++::::-:-+@###***##@###++%%===*======#==...-............%
//                                      ++*     -===+#+*###@+++++++++::-:+*####%**********####-=#*==*=:::=***=:................*
//                                        +@  =--=#*+*###*#++++++++..+@%####***#**###*****%####%#**===:::=***%=.................*
//                                          *---#*+*### =++-+++++:=####%####%+#+++++++++%%#*######*+===*====+*+..................
//                                      %+=*--#+++###@@@@@%#-=++#%######%++++++++::::++++%%%#%%%%***=***==**=**=.................
//                                  %--====*#+++###@#######%@-*##*##@++++::::::::::::=++++#@#%*%#************=*@................=%@
//                                   +==*-+#**#%####%*#####+*@*%@*%+++-::::::::::::::+++=@%%%%##************+==+==.........===..###:-
//                           @-=--==%#==*#%########+%#########**%##+=::::::::::::::::++#%%%%*+##***********+**-:===....:.====..*#%==#
//                        =====**--==##==*####*++++++*####%##%#*##+:::::::::::::::::++%%%##*##%#***#*******+%++%=======.=....=*++::*@
//                      ====*%  ###+%##%##++++*++++++++++++++%**#+:::::::::::::::::+=#####*#@**#*******####+++=========..==-++=-=:#*+
//                     *==%###   #+=#*  *+++++%@ @@@@*        @#%:::::::::::::::::+**#*******#+*************#------==----@ @*%=*****+
//                   %=+=+#+-=#==+**     @                      ::::::::::::::::=-++-+++++++++++++********#@%------+        #********#
//                   *##%+%*=*#*@                              @::::::::::::::=++++++    @++++++++++++****+             *###@********+
//                 %##%% #=+#                                  :::::::::::::-++++++++#           @%*+++*#             @*%:::+*********
//                 ##=-#%+##                                  ::.:::::::::-++++++++++=                               #+#-*-%-%********%
//                @+%==###*                                  %:::::::::::+*+++++++++++                           ******++#*#+**********
//                 @+=+=+*#@                                 -::::::::::+=++++++++++++@                       %*****##+-+@************+
//                   ===@##+                                %::::::::::+=*++++++++++++*                 %*=+#*****%##-::::::**********+
//                    ===###                                .::::::::::+@ -+++++++++++-              **#:::=##+-*::::*:::::::*********+
//                    #=+###@                              .::::::::::--   -+++++++++++             @#=:::#++#+#::::::*:::::-**%*******
//                     @***+@                             .:::::::::::+@    -=+++++++++@            ##+:::#*=+##:::::::::::=**##******#
//                                                       .:::::::::::==      *-+++++++++            *##++*#*****:::::::::%***###******%
//                                                      .::::::::::::++       @-=+++++++@            %%#*###*****#%++%#***######******
//                                                    %.::::::::::::++          --+++++++-       -++++*@@@+###*********##########*#***
//                                                   %::::::::::::::+@           -=+++++++=     -=++==:*@###%############%+@####******
//                                                  -::::::::::::::+@             ==++++++++   --=+++++=*****########%##**%::*%**#***#
//                                                 .:::::::::::::+=@               --=+++++=:::-#**%++*###########%%**####+:::::*****@
//                 %%%#                          %....-:::::::::+-                  #--*+=:-:::::******#%####=-::::::+++++::::::*****
//              #%**#****++                     .........::::-+-                     *--=+::::::++#******#%+::::::::::::::::::::*****
//             *##**#*****#+=%##@             %.........=.++=-                        ---++:-:::::********#+:::::::::::::::::::*****%
//            @**%#*%#+***#++=.........@**++%..........====%                          *--=+=::::::********##:::::::::::::::::-*****#@
//             %*+@*#*******%+*.........#%#**+.....:===--=                            @---=++-::++********#@::::::::::::::::*******#
//            *%***#%*#*****+++-........###%#####==----=                               ----=+++++##*****#*##+:::::::::-**+********#%
//            ********##*****+++#.......#%+++++###%---                                  -------=+#########@##++:::::#********#**#==-
//            ****@*%#*%***#**-:+%#**:.#-%####+++##%                                     -+=+**%%#*****#####@#%+++@*#*********%%:--
//            @*%**%%**#*****+:---+%*%#**@###%#++=+%%%                                   @-=++++++     @*+*#*####*#***********+*@
//            #*%#%**#*#******++#:@##*+++=+#%###=+++%%@                                   --+++++++        %**###**#+**********
//             *#******#**%**++++%###+++#++++%#+++++#%%                                    %#=====:          #*##::::-*#******@
//              **#*****@#*#++++%#%%=-+=+#++++++++#####                                    =-=====-           *++::-::::=#***#
//               @***%@**#*****%###+*:-++*##+*###**++                                       -======          -=++:::::::::+*#
//                 +***#%*%*#%%###*++#-=####+++++++                                          -=====          --=++-::::=::-#
//                     *%*******#**########***+*                                            @#=====%%%%     %----=++::::::*
//                        ****###########*++#**                                           *%%%=====+%%%      ------+++:::+
//                       ***#**%########*++%                                             %%##**##@%%###       ------=++#@
//                      **#***%#%####**+++                                               *%+*###%%%#%%+        %------%
//                       %%%####*#****%+%                                                 #%****#%*%%**
//                        **%**%******@                                                   #******%%%###@
//                          **##****@                                                    @=*******%#*++
//                            ##                                                         ==*******+##*#+
//                                                                                      @==******+=%#*###
//                                                                                      *==+*****%%%*###*
//                                                                                      %==+***#@##*%@##*
//                                                                                      +++##%####**#%##@
//                                                                                      +####%%###%%%
//                                                                                     *##%#%#%#####*
//                                                                                     *%########%##*
//                                                                                     *%@######%%

// folly: awesome!
// Maimai: :3
